<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>IPREGOBA - Compartilhar Prova de Vida</title>
    <!-- Biblioteca para gerar PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root {
            --primary-color: #004a8f;
            --secondary-color: #f4f6f9;
            --text-color: #333;
            --border-radius: 12px;
            --success-color: #25D366; /* Cor do WhatsApp */
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #eef1f5;
            color: var(--text-color);
            margin: 0;
            padding: 0;
            padding-bottom: 60px;
        }

        /* Header fixo */
        .app-header {
            background-color: var(--primary-color);
            color: white;
            padding: 20px;
            text-align: center;
            border-bottom-left-radius: 20px;
            border-bottom-right-radius: 20px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .app-header h1 { margin: 0; font-size: 1.2rem; font-weight: 700; }
        .app-header p { margin: 5px 0 0; font-size: 0.85rem; opacity: 0.9; }

        .container { padding: 15px; max-width: 600px; margin: 0 auto; }

        /* Cart√µes */
        .card {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .card-title {
            color: var(--primary-color);
            font-weight: 700;
            font-size: 1rem;
            margin-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 8px;
        }

        /* Inputs */
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 6px; font-weight: 600; font-size: 0.9rem; color: #555; }
        
        input[type="text"], input[type="tel"], input[type="date"], select {
            width: 100%; padding: 12px; border: 1px solid #ddd;
            border-radius: 8px; font-size: 16px; background-color: #fafafa;
        }
        
        input:focus, select:focus { border-color: var(--primary-color); outline: none; background-color: #fff; }

        /* Bot√µes Especiais */
        .camera-btn {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding: 20px; border: 2px dashed var(--primary-color); border-radius: var(--border-radius);
            background-color: #f0f7ff; color: var(--primary-color); font-weight: bold; cursor: pointer;
            text-align: center; margin-bottom: 10px;
            /* Garante texto mai√∫sculo */
            text-transform: uppercase; 
        }

        #preview-img { width: 100%; border-radius: 8px; margin-top: 10px; display: none; border: 1px solid #ddd; }

        .geo-btn {
            width: 100%; padding: 12px; background-color: #fff; border: 1px solid #ccc;
            color: #333; border-radius: 8px; font-size: 0.9rem; display: flex;
            align-items: center; justify-content: center; margin-bottom: 10px;
        }
        .geo-success { background-color: #e8f5e9; border-color: #28a745; color: #28a745; }

        /* Assinatura */
        .signature-pad {
            border: 1px solid #ccc; border-radius: 8px; width: 100%; height: 180px;
            background-color: #fff; touch-action: none;
        }
        .clear-link {
            color: #d9534f; font-size: 0.85rem; text-decoration: underline;
            background: none; border: none; padding: 5px; display: block; margin: 5px auto 0; cursor: pointer;
        }

        /* Switches */
        .checkbox-wrapper { display: flex; align-items: center; gap: 10px; padding: 10px 0; }
        .toggle-switch { position: relative; display: inline-block; width: 48px; height: 26px; flex-shrink: 0; }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .slider {
            position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0;
            background-color: #ccc; transition: .4s; border-radius: 34px;
        }
        .slider:before {
            position: absolute; content: ""; height: 20px; width: 20px; left: 3px; bottom: 3px;
            background-color: white; transition: .4s; border-radius: 50%;
        }
        input:checked + .slider { background-color: var(--primary-color); }
        input:checked + .slider:before { transform: translateX(22px); }

        /* Bot√£o Principal */
        .share-btn {
            width: 100%; padding: 18px; background-color: var(--success-color);
            color: white; border: none; border-radius: 30px; font-size: 1.1rem; font-weight: bold;
            margin-top: 15px; box-shadow: 0 4px 12px rgba(37, 211, 102, 0.4); cursor: pointer;
            display: flex; align-items: center; justify-content: center; gap: 10px;
        }
        .share-btn:active { transform: scale(0.98); }
        .share-btn:disabled { background-color: #ccc; cursor: not-allowed; box-shadow: none; }

        .hidden { display: none; }
        
        /* Loading Overlay */
        #loadingOverlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.9); z-index: 999; flex-direction: column;
            justify-content: center; align-items: center; text-align: center;
        }
        .spinner {
            border: 4px solid #f3f3f3; border-top: 4px solid var(--primary-color);
            border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Links */
        a.maps-link {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: bold;
        }
        
        /* Mensagem de erro GPS */
        .gps-error-msg {
            color: #d9534f;
            font-size: 0.85rem;
            margin-top: 5px;
            text-align: center;
            border: 1px solid #d9534f;
            background-color: #fdf7f7;
            padding: 8px;
            border-radius: 8px;
        }

    </style>
</head>
<body>

    <div class="app-header">
        <h1>IPREGOBA Digital</h1>
        <p>Prova de Vida & Recadastramento</p>
    </div>

    <form id="formProvaVida" class="container">

        <!-- 1. Identifica√ß√£o -->
        <div class="card">
            <div class="card-title">üë§ Dados do Benefici√°rio</div>
            
            <div class="form-group">
                <label>Nome Completo</label>
                <input type="text" id="nome" placeholder="Nome completo" required>
            </div>
            <div class="form-group">
                <label>CPF</label>
                <input type="tel" id="cpf" placeholder="000.000.000-00" required>
            </div>
            <div class="form-group">
                <label>Matr√≠cula</label>
                <input type="tel" id="matricula" placeholder="N¬∫ Matr√≠cula">
            </div>
            
            <!-- Novos campos adicionados -->
            <div class="form-group">
                <label for="nascimento">Data de Nascimento</label>
                <input type="date" id="nascimento" required>
            </div>
            
            <div class="form-group">
                <label for="estado_civil">Estado Civil</label>
                <select id="estado_civil">
                    <option value="">Selecione...</option>
                    <option value="Solteiro(a)">Solteiro(a)</option>
                    <option value="Casado(a)">Casado(a)</option>
                    <option value="Divorciado(a)">Divorciado(a)</option>
                    <option value="Vi√∫vo(a)">Vi√∫vo(a)</option>
                    <option value="Uni√£o Est√°vel">Uni√£o Est√°vel</option>
                </select>
            </div>
        </div>

        <!-- 2. Localiza√ß√£o e Contato -->
        <div class="card">
            <div class="card-title">üìç Localiza√ß√£o</div>
            
            <div class="form-group">
                <label>Confirma√ß√£o de Local</label>
                <button type="button" class="geo-btn" id="btnGeo" onclick="capturarLocalizacao()">
                    üìç Obter Localiza√ß√£o (Google Maps)
                </button>
                <div id="geo-texto" style="text-align:center; margin-top:10px; font-size:0.9rem;"></div>
                <input type="hidden" id="gps_lat">
                <input type="hidden" id="gps_long">
            </div>
            <div class="form-group">
                <label>Cidade Atual</label>
                <input type="text" id="cidade" value="Garopaba/SC">
            </div>
        </div>

        <!-- 3. Foto -->
        <div class="card">
            <div class="card-title">üì∑ Foto de Comprova√ß√£o</div>
            <p style="font-size: 0.85rem; color: #666; margin-bottom: 15px;">
                Tire uma selfie segurando um documento oficial com foto ao lado do rosto. A data e hora ser√£o adicionadas automaticamente na imagem.
            </p>
            
            <label class="camera-btn">
                <span>üì∏ TIRAR SELFIE</span>
                <!-- capture="user" for√ßa c√¢mera frontal. Se falhar, accept="image/*" ainda deve permitir escolher a c√¢mera -->
                <input type="file" id="foto_input" accept="image/*" capture="user" style="display: none;" onchange="processarFoto(this)">
            </label>
            <img id="preview-img">
        </div>

        <!-- 4. Declara√ß√µes -->
        <div class="card">
            <div class="checkbox-wrapper">
                <label class="toggle-switch">
                    <input type="checkbox" id="acumula_cargo">
                    <span class="slider"></span>
                </label>
                <span>Possui outro cargo p√∫blico?</span>
            </div>
            <input type="text" id="cargo_desc" class="hidden form-group" style="width:100%; margin-top:10px; padding:10px;" placeholder="Qual cargo e onde?">

            <div class="checkbox-wrapper">
                <label class="toggle-switch">
                    <input type="checkbox" id="pensao_alim">
                    <span class="slider"></span>
                </label>
                <span>Paga Pens√£o Aliment√≠cia?</span>
            </div>
        </div>

        <!-- 5. Assinatura -->
        <div class="card">
            <div class="card-title">‚úçÔ∏è Assinatura</div>
            <p style="font-size: 0.8rem; color: #555; margin-bottom: 10px;">
                Declaro que as informa√ß√µes s√£o verdadeiras. Assine abaixo:
            </p>
            <canvas id="signaturePad" class="signature-pad"></canvas>
            <button type="button" class="clear-link" onclick="limparAssinatura()">Limpar Assinatura</button>
            <p id="data-hoje" style="text-align: center; font-size: 0.8rem; color: #888; margin-top: 10px;"></p>
        </div>

        <button type="button" class="share-btn" onclick="gerarECompartilharPDF()">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="18" cy="5" r="3"></circle><circle cx="6" cy="12" r="3"></circle><circle cx="18" cy="19" r="3"></circle><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line></svg>
            COMPARTILHAR PDF (WhatsApp)
        </button>

    </form>

    <div id="loadingOverlay">
        <div class="spinner"></div>
        <h3>Gerando Documento...</h3>
        <p>Aguarde um momento.</p>
    </div>

    <script>
        // --- 1. Inicializa√ß√£o ---
        const { jsPDF } = window.jspdf;
        const dataElement = document.getElementById('data-hoje');
        const hoje = new Date();
        dataElement.innerText = `${hoje.toLocaleDateString('pt-BR')}`;
        
        // Vari√°veis globais para imagens
        let fotoBase64 = null;

        // --- 2. Geolocaliza√ß√£o (Google Maps) ---
        function capturarLocalizacao() {
            const btn = document.getElementById('btnGeo');
            const txt = document.getElementById('geo-texto');
            
            if (!navigator.geolocation) {
                txt.innerHTML = "<div class='gps-error-msg'>Seu navegador n√£o suporta geolocaliza√ß√£o.</div>";
                return;
            }

            if (window.location.protocol !== 'https:' && window.location.hostname !== 'localhost' && window.location.hostname !== '127.0.0.1') {
                 txt.innerHTML = "<div class='gps-error-msg'>‚ö†Ô∏è <strong>Erro de Seguran√ßa:</strong> O GPS requer uma conex√£o segura (HTTPS).<br>Se voc√™ estiver testando localmente, use localhost. Se estiver em produ√ß√£o, verifique o certificado SSL.</div>";
                 return;
            }
            
            btn.innerHTML = "‚è≥ Buscando sat√©lite...";
            txt.innerHTML = "";

            navigator.geolocation.getCurrentPosition(
                (pos) => {
                    const lat = pos.coords.latitude;
                    const long = pos.coords.longitude;
                    
                    document.getElementById('gps_lat').value = lat;
                    document.getElementById('gps_long').value = long;
                    
                    const mapsUrl = `https://www.google.com/maps?q=${lat},${long}`;
                    
                    btn.classList.add('geo-success');
                    btn.innerHTML = "‚úÖ Localiza√ß√£o Capturada";
                    
                    txt.innerHTML = `
                        <a href="${mapsUrl}" target="_blank" class="maps-link">
                            üó∫Ô∏è Abrir no Google Maps
                        </a>
                        <br>
                        <small style="color:#999">Lat: ${lat.toFixed(5)}, Long: ${long.toFixed(5)}</small>
                    `;
                },
                (err) => {
                    console.error(err);
                    let msg = "Erro desconhecido ao obter GPS.";
                    let detalhe = "";

                    switch(err.code) {
                        case err.PERMISSION_DENIED:
                            msg = "Permiss√£o de GPS negada.";
                            detalhe = "Por favor, verifique as configura√ß√µes do seu navegador ou celular e permita o acesso √† localiza√ß√£o para este site.";
                            break;
                        case err.POSITION_UNAVAILABLE:
                            msg = "Sinal de GPS indispon√≠vel.";
                            detalhe = "Verifique se o GPS do seu aparelho est√° ligado e se voc√™ est√° em uma √°rea com sinal claro.";
                            break;
                        case err.TIMEOUT:
                            msg = "Tempo esgotado ao buscar GPS.";
                            detalhe = "A busca demorou muito. Tente novamente em um local com melhor sinal.";
                            break;
                    }
                    
                    btn.innerHTML = "üìç Tentar Novamente";
                    txt.innerHTML = `<div class='gps-error-msg'><strong>Erro: ${msg}</strong><br>${detalhe}</div>`;
                },
                { enableHighAccuracy: true, timeout: 15000, maximumAge: 0 }
            );
        }

        // --- 3. C√¢mera e Imagens (Com Timestamp CORRIGIDO) ---
        function processarFoto(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    otimizarEAdicionarTimestamp(e.target.result, (finalBase64) => {
                        fotoBase64 = finalBase64;
                        const imgPreview = document.getElementById('preview-img');
                        imgPreview.src = finalBase64;
                        imgPreview.style.display = 'block';
                    });
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        function otimizarEAdicionarTimestamp(base64Str, callback) {
            const img = new Image();
            img.src = base64Str;
            img.onload = () => {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                const MAX_WIDTH = 1280; 
                let width = img.width;
                let height = img.height;

                if (width > MAX_WIDTH) {
                    height *= MAX_WIDTH / width;
                    width = MAX_WIDTH;
                }

                canvas.width = width;
                canvas.height = height;

                // 1. Desenha imagem
                ctx.drawImage(img, 0, 0, width, height);

                // 2. Configura√ß√µes da fonte
                const dataHoraAgora = new Date().toLocaleString('pt-BR');
                const textoTimestamp = `IPREGOBA Prova de Vida - ${dataHoraAgora}`;

                const fontSize = Math.max(16, Math.floor(width * 0.03));
                ctx.font = `bold ${fontSize}px sans-serif`;
                
                // Medidas para o fundo preto
                const metrics = ctx.measureText(textoTimestamp);
                const textWidth = metrics.width;
                const textHeight = fontSize * 1.2;
                
                const paddingX = Math.floor(width * 0.02);
                const paddingY = Math.floor(height * 0.02);
                
                // Posi√ß√£o (Canto inferior direito)
                const xPos = width - textWidth - paddingX - 10;
                const yPos = height - paddingY - 10;

                // 3. Desenha TARJA PRETA de fundo (para garantir leitura)
                ctx.fillStyle = "rgba(0, 0, 0, 0.6)"; // Preto semi-transparente
                ctx.fillRect(xPos - 10, yPos - textHeight + (fontSize * 0.3), textWidth + 20, textHeight);

                // 4. Desenha o texto BRANCO por cima
                ctx.fillStyle = "#ffffff";
                ctx.textAlign = 'left'; 
                ctx.textBaseline = 'bottom';
                ctx.fillText(textoTimestamp, xPos, yPos);

                callback(canvas.toDataURL('image/jpeg', 0.8));
            }
        }

        // --- 4. Assinatura (Canvas) ---
        const canvas = document.getElementById('signaturePad');
        const ctx = canvas.getContext('2d');
        let isDrawing = false;

        function resizeCanvas() {
            const ratio = Math.max(window.devicePixelRatio || 1, 1);
            canvas.width = canvas.offsetWidth * ratio;
            canvas.height = canvas.offsetHeight * ratio;
            ctx.scale(ratio, ratio);
        }
        window.addEventListener("resize", resizeCanvas);
        resizeCanvas();

        function getPos(e) {
            const rect = canvas.getBoundingClientRect();
            let clientX = e.clientX;
            let clientY = e.clientY;
            if (e.touches && e.touches.length > 0) {
                clientX = e.touches[0].clientX;
                clientY = e.touches[0].clientY;
            }
            return { x: clientX - rect.left, y: clientY - rect.top };
        }

        function startDraw(e) {
            isDrawing = true;
            ctx.beginPath();
            const pos = getPos(e);
            ctx.moveTo(pos.x, pos.y);
        }
        
        function moveDraw(e) {
            if (!isDrawing) return;
            const pos = getPos(e);
            ctx.lineWidth = 2;
            ctx.lineCap = 'round';
            ctx.strokeStyle = '#000';
            ctx.lineTo(pos.x, pos.y);
            ctx.stroke();
            e.preventDefault();
        }
        
        function endDraw() { isDrawing = false; }

        canvas.addEventListener('mousedown', startDraw);
        canvas.addEventListener('mousemove', moveDraw);
        canvas.addEventListener('mouseup', endDraw);
        canvas.addEventListener('touchstart', startDraw, {passive: false});
        canvas.addEventListener('touchmove', moveDraw, {passive: false});
        canvas.addEventListener('touchend', endDraw);

        function limparAssinatura() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        // --- 5. Toggles ---
        document.getElementById('acumula_cargo').addEventListener('change', function() {
            document.getElementById('cargo_desc').style.display = this.checked ? 'block' : 'none';
        });

        // --- 6. Gerar PDF e Compartilhar ---
        async function gerarECompartilharPDF() {
            const nome = document.getElementById('nome').value;
            const cpf = document.getElementById('cpf').value;
            const nascimento = document.getElementById('nascimento').value;
            
            if (!nome || !cpf || !nascimento) {
                alert("Por favor, preencha Nome, CPF e Data de Nascimento.");
                return;
            }
            if (!fotoBase64) {
                alert("A foto de comprova√ß√£o √© obrigat√≥ria.");
                return;
            }

            document.getElementById('loadingOverlay').style.display = 'flex';

            try {
                const doc = new jsPDF();
                const margin = 15;
                let yPos = 20;

                doc.setFillColor(0, 74, 143);
                doc.rect(0, 0, 210, 30, 'F');
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(16);
                doc.setFont("helvetica", "bold");
                doc.text("IPREGOBA - Prova de Vida Digital", 105, 15, { align: "center" });
                doc.setFontSize(10);
                doc.setFont("helvetica", "normal");
                doc.text(`Gerado em: ${new Date().toLocaleString('pt-BR')}`, 105, 22, { align: "center" });

                yPos = 45;
                doc.setTextColor(0, 0, 0);
                doc.setFontSize(12);
                doc.setFont("helvetica", "bold");
                doc.text("1. DADOS DO SEGURADO", margin, yPos);
                
                yPos += 8;
                doc.setFontSize(10);
                doc.setFont("helvetica", "normal");
                doc.text(`Nome: ${nome}`, margin, yPos);
                doc.text(`CPF: ${cpf}`, margin + 100, yPos);
                
                yPos += 6;
                doc.text(`Matr√≠cula: ${document.getElementById('matricula').value || '---'}`, margin, yPos);
                
                const dataNascFormatada = nascimento ? new Date(nascimento).toLocaleDateString('pt-BR', { timeZone: 'UTC' }) : '---';
                yPos += 6;
                doc.text(`Data de Nascimento: ${dataNascFormatada}`, margin, yPos);
                doc.text(`Estado Civil: ${document.getElementById('estado_civil').value || '---'}`, margin + 100, yPos);
                
                yPos += 12;
                doc.setFontSize(12);
                doc.setFont("helvetica", "bold");
                doc.text("2. LOCALIZA√á√ÉO E CONTATO", margin, yPos);
                
                yPos += 8;
                doc.setFontSize(10);
                doc.setFont("helvetica", "normal");
                
                const lat = document.getElementById('gps_lat').value;
                const long = document.getElementById('gps_long').value;
                
                doc.text(`Cidade Declarada: ${document.getElementById('cidade').value}`, margin, yPos);
                yPos += 6;
                
                if (lat && long) {
                    const mapsLink = `https://www.google.com/maps?q=${lat},${long}`;
                    doc.text("GPS: ", margin, yPos);
                    doc.setTextColor(0, 0, 255);
                    doc.textWithLink("Clique aqui para ver no Google Maps", margin + 10, yPos, { url: mapsLink });
                    doc.setTextColor(0, 0, 0);
                    yPos += 5;
                    doc.setFontSize(8);
                    doc.setTextColor(100);
                    doc.text(`(${lat}, ${long})`, margin, yPos);
                    doc.setTextColor(0);
                    doc.setFontSize(10);
                } else {
                    doc.text("GPS: N√£o capturado no momento do envio.", margin, yPos);
                }

                yPos += 12;
                doc.setFontSize(12);
                doc.setFont("helvetica", "bold");
                doc.text("3. DECLARA√á√ïES", margin, yPos);
                
                yPos += 8;
                doc.setFontSize(10);
                doc.setFont("helvetica", "normal");
                const acumula = document.getElementById('acumula_cargo').checked ? "SIM" : "N√ÉO";
                const pensao = document.getElementById('pensao_alim').checked ? "SIM" : "N√ÉO";
                
                doc.text(`Acumula Cargo P√∫blico? ${acumula}`, margin, yPos);
                if(acumula === "SIM") {
                    yPos += 6;
                    doc.text(`Detalhes: ${document.getElementById('cargo_desc').value}`, margin, yPos);
                }
                yPos += 6;
                doc.text(`Paga Pens√£o Aliment√≠cia? ${pensao}`, margin, yPos);

                yPos += 15;
                doc.setFontSize(12);
                doc.setFont("helvetica", "bold");
                doc.text("4. COMPROVA√á√ÉO VISUAL", margin, yPos);
                
                if (fotoBase64) {
                    const imgProps = doc.getImageProperties(fotoBase64);
                    const imgWidth = 90;
                    const imgHeight = (imgProps.height * imgWidth) / imgProps.width;
                    doc.addImage(fotoBase64, 'JPEG', 60, yPos + 5, imgWidth, imgHeight);
                    yPos += imgHeight + 10;
                }

                if (yPos > 220) { doc.addPage(); yPos = 20; }
                
                yPos += 15;
                doc.text("5. ASSINATURA", margin, yPos);
                const signatureData = canvas.toDataURL('image/png');
                doc.addImage(signatureData, 'PNG', margin, yPos + 5, 80, 40);
                
                doc.setLineWidth(0.5);
                doc.line(margin, yPos + 45, margin + 80, yPos + 45);
                doc.setFontSize(8);
                doc.text("Assinatura do Segurado", margin, yPos + 50);

                const pdfBlob = doc.output('blob');
                const file = new File([pdfBlob], `ProvaVida_${nome.split(' ')[0]}.pdf`, { type: "application/pdf" });

                if (navigator.share && navigator.canShare && navigator.canShare({ files: [file] })) {
                    await navigator.share({
                        files: [file],
                        title: 'Prova de Vida IPREGOBA',
                        text: `Segue em anexo a prova de vida de ${nome}.`,
                    });
                } else {
                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(pdfBlob);
                    link.download = `ProvaVida_${nome}.pdf`;
                    link.click();
                    alert("O arquivo PDF foi baixado no seu dispositivo. Voc√™ pode envi√°-lo manualmente.");
                }

            } catch (error) {
                console.error(error);
                alert("Erro ao gerar documento. Tente novamente.");
            } finally {
                document.getElementById('loadingOverlay').style.display = 'none';
            }
        }
    </script>
</body>
</html>
